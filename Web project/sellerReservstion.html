<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Reservation</title>
    <link rel="stylesheet" href="sellerReservation.css">
</head>
<body>
    <h1>Reservations</h1>
    <table id="reservation-table">
        <thead>
            <tr>
                <th>Status of Reservation</th>
                <th>Username</th>
                <th>Number of People</th>
                <th>Date</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody id="reservation-details">
            <!-- Reservation data will be dynamically added here -->
        </tbody>
    </table>
    <script>
    
    window.addEventListener('message', function(event) {
    if (event.data.type === 'updateTable') {
        updateTable();
    }
});

function updateTable() {
    // Retrieve reservation data from localStorage
    var reservations = JSON.parse(localStorage.getItem('reservations')) || [];

    // Display reservation data in the table
    var tableBody = document.getElementById('reservation-details');
    tableBody.innerHTML = ''; // Clear existing table rows
    var username = localStorage.getItem('username');
    var defaultStatus = 'Pending'; 

    reservations.forEach(function(reservation) {
        var newRow = tableBody.insertRow();
        newRow.insertCell().textContent = reservation.status; 
        newRow.insertCell().textContent = reservation.username;
        newRow.insertCell().textContent = reservation.number;
        newRow.insertCell().textContent = reservation.date;
        newRow.insertCell().textContent = reservation.time;

        // Add action buttons for confirm, decline, and remove reservation
        var actionCell = newRow.insertCell();

        // Confirm button
        var confirmButton = document.createElement('button');
        confirmButton.textContent = 'Confirm';
        confirmButton.classList.add('confirm'); // Add class for styling
        confirmButton.onclick = function() {
            reservation.status = 'Confirmed';
            localStorage.setItem('reservations', JSON.stringify(reservations));
            newRow.cells[0].textContent = 'Confirmed'; // Update status cell
            console.log('Reservation confirmed:', reservation);

            // Remove all buttons
            removeAllButtons();
        };
        actionCell.appendChild(confirmButton);

        // Decline button
        var declineButton = document.createElement('button');
        declineButton.textContent = 'Decline';
        declineButton.classList.add('decline'); // Add class for styling
        declineButton.onclick = function() {
            reservation.status = 'Declined';
            localStorage.setItem('reservations', JSON.stringify(reservations));
            newRow.cells[0].textContent = 'Declined'; // Update status cell
            console.log('Reservation declined:', reservation);

            // Remove both confirm and decline buttons
            removeButtons();

            // Show the "Remove Reservation" button
            removeButton.style.display = 'block';
        };
        actionCell.appendChild(declineButton);

        // Add "Remove Reservation" button
        var removeButton = document.createElement('button');
        removeButton.textContent = 'Remove Reservation';
        removeButton.style.display = 'none'; // Initially hide the button
        removeButton.onclick = function() {
            var index = reservations.indexOf(reservation);
            if (index !== -1) {
                reservations.splice(index, 1);
                localStorage.setItem('reservations', JSON.stringify(reservations));
                tableBody.removeChild(newRow); // Remove row from the table
                console.log('Reservation removed:', reservation);
            }
        };
        actionCell.appendChild(removeButton);

        // Function to remove confirm and decline buttons
        function removeButtons() {
            actionCell.removeChild(confirmButton);
            actionCell.removeChild(declineButton);
        }

        // Function to remove all buttons
        function removeAllButtons() {
            removeButtons(); // Remove confirm and decline buttons
            actionCell.removeChild(removeButton); // Remove the remove button
        }

        // Check the reservation status to decide whether to add buttons
        if (reservation.status === 'Confirmed'){
            removeAllButtons();
            removeButton.style.display = 'block';
        } 
        if(reservation.status === 'Declined') {
            removeButtons();
            removeButton.style.display = 'block';
        }
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form#reservation-form');

    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission

        // Collect form data
        const formData = {
            username: localStorage.getItem('username'),
            number: document.getElementById('number').value,
            date: document.getElementById('date').value,
            time: document.getElementById('time').value
        };
     
        // Retrieve existing reservations from localStorage or initialize an empty array
        let reservations = JSON.parse(localStorage.getItem('reservations')) || [];

        // Add the new reservation to the array
        reservations.push(formData);

        // Save the updated reservations array to localStorage
        localStorage.setItem('reservations', JSON.stringify(reservations));

        // Clear the form fields
        document.getElementById('number').value = '';
        document.getElementById('date').value = '';
        document.getElementById('time').value = '';

        // Trigger an event to inform the other HTML page to update the table
        window.parent.postMessage({ type: 'updateTable' }, '*');
    });
});

// Initial update of the table
updateTable();
  </script>
    
</body>
</html>
