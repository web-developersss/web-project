<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Details</title>
    <link rel="stylesheet" href="detailscss.css">
    <link rel="icon" href="https://cdn5.f-cdn.com/contestentries/70431/10651466/53406793a0826_thumb900.jpg" type="image/x-icon"/>
    <style>body, html {
        height: 100%;
        margin: 0;
        font-family: 'Arial', sans-serif;
        background-color: #f9eae1; /* Background color for the whole page */
        overflow-x: hidden; /* Prevents horizontal scrollbar */
    }
    
    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px; /* This adds some padding around the container */
    }
    
    .content {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%; /* Takes full width of the container */
        box-shadow: 0 2px 15px rgba(0,0,0,0.1); /* Shadow effect */
        background: #D6A675; /* White background for content */
    }
    
    .text-section {
        flex: 1; /* Allows this section to grow and take up 50% of the .content width */
        padding: 50px; /* Padding inside the text section */
    }
    
    .image-section {
        flex: 1; /* Allows this section to grow and take up 50% of the .content width */
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    #restaurant-image {
        width: 100%;
        height: auto;
        max-height: 500px; /* Controls the max height of the image */
        object-fit: cover; /* Ensures the image covers the assigned area, may crop */
    }
    
    
    
    @media (max-width: 768px) {
        .container {
            padding: 0; /* Remove padding on smaller screens */
        }
        .content {
            flex-direction: column;
            padding: 0; /* Remove padding on smaller screens */
        }
        .text-section, .image-section {
            padding: 20px; /* Add padding inside the sections on smaller screens */
        }
        .image-section {
            order: -1; /* Moves the image above the text on smaller screens */
        }
        #restaurant-image {
            max-height: 300px; /* Adjusts max height for the image on smaller screens */
        }
    }
    
    .info-icons {
        text-align: center;
        margin-top: 20px; /* Spacing from the main content block */
    }
    
    .info-icons a, .info-icons span {
        margin-right: 20px; /* Spacing between icons */
        text-decoration: none; /* Remove underline from links */
        color: #333; /* Icon text color */
        cursor: pointer;
    }
    
    .info-icons a:hover, .info-icons span:hover {
        color: #777; /* Hover color */
    }
    
    #phone-message {
        display: none; /* Hidden by default */
        position: fixed; /* Overlay over the page */
        top: 50%; /* Center vertically */
        left: 50%; /* Center horizontally */
        transform: translate(-50%, -50%); /* Centering adjustment */
        background-color: white; /* Background of the message box */
        padding: 20px; /* Padding inside the message box */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Shadow for visibility */
        z-index: 1000; /* Ensure it's above other content */
    }
    
    button {
        z-index: 1;
        position: relative;
        font-size: inherit;
        font-family: inherit;
        color: white;
        padding: 0.5em 1em;
        outline: none;
        border: none;
        background-color: black;
      }
      
      button::before {
        content: '';
        z-index: -1;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: gray;
        transform-origin: center bottom;
        transform: scaleY(0);
        transition: transform 0.25s ease-in-out;
      }
      
      button:hover {
        cursor: pointer;
      }
      
      button:hover::before {
        transform-origin: center top;
        transform: scaleY(1);
      }
      .iframe-styling {
        overflow: hidden;
        position: fixed;
        width: 100%;
        z-index: 998; /* Lower than the openbtn */
        text-align: right; /* Align the text to the right */
    border: none;
    }
    
    
    
    #login-prompt, #reservation-form {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        z-index: 100;
        display: none;
    }
    
    /* Background cover */
    .modal-cover {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 50;
        display: none;
    }
    </style>
</head>
<body>
   <%- include("navbar.ejs") %>

    <div class="container">
        <div class="content">
            <div class="text-section">
                <h1 id="restaurant-name"><%= restaurant.name %></h1>
                <p id="restaurant-description"><%= restaurant.description %></p>
                <button id="reservation-button">Reserve Now!</button>

                <div id="login-prompt" style="display:none;">
                    <p>Please sign in to make a reservation.</p>
                    <button onclick="window.location.href='/signin';">Sign In</button>
                </div>
                
                <!-- Modal/Popup for Reservation Form -->
                <div id="reservation-form" style="display:none;">
                    <form action="/details" method="POST">
                        <input type="hidden" name="restaurantId" value="<%= restaurant._id %>">
                        <label for="number">Number of People:</label>
                        <input type="number" id="number" name="numberOfPeople" required>
                        <label for="date">Date:</label>
                        <input type="date" id="date" name="date" required>
                        <label for="time">Time:</label>
                        <input type="time" id="time" name="time" required>
                        <button id="reservation-submit" type="submit">Confirm Reservation</button>
                    </form>
                </div>

                <div class="info-icons">
                    <a href="<%= restaurant.locationLink %>" target="_blank" id="location-icon">&#x1F4CD; Location</a>
                    <span id="phone-icon" style="cursor:pointer;">&#x1F4DE; Phone</span>
                    <a href="<%= restaurant.menuLink %>" target="_blank" id="menu-icon">&#x1F374; Menu</a>
                </div>
                
                <div id="phone-message" class="phone-message-hidden">
                    <p id="phone-number"><%= restaurant.phone %></p>
                    <button id="close-phone-message">Close</button>
                </div>
            </div>
            <div class="image-section">
                <img id="restaurant-image" src="<%= restaurant.image %>" alt="Restaurant Image">
            </div>
        </div>
    </div>
    <script>

        // Function to update the restaurant details in the HTML
        function updateRestaurantDetails(restaurant) {
            // Update text and image
            document.getElementById('restaurant-name').textContent = restaurant.name;
            document.getElementById('restaurant-image').src = restaurant.image;
            document.getElementById('restaurant-description').textContent = restaurant.description;
        
            // Generate the HTML content for the info-icons
            const infoIconsHtml = `
                <a href="${restaurant.locationUrl}" target="_blank">&#x1F4CD; Location</a>
                <span id="phone-icon">&#x1F4DE; Phone</span>
                <a href="${restaurant.menuUrl}" target="_blank">&#x1F374; Menu</a>
            `;
        
            // Insert the HTML into the info-icons div
            const infoIconsDiv = document.querySelector('.info-icons');
            infoIconsDiv.innerHTML = infoIconsHtml;
        
            // Attach click event to phone icon after it has been added to the DOM
            const phoneIcon = document.getElementById('phone-icon');
            phoneIcon.addEventListener('click', function() {
                // Call the function to show the phone message
                showPhoneMessage(restaurant.phone);
            });
        }
        
        // Function to show the phone number message
        function showPhoneMessage(phoneNumber) {
            const phoneMessage = document.getElementById('phone-message');
            const phoneNumberElement = document.getElementById('phone-number');
            phoneNumberElement.textContent = `Call us: ${phoneNumber}`;
            phoneMessage.style.display = 'block';
        }
        
        // Function to close the phone number message
        function closePhoneMessage() {
            const phoneMessage = document.getElementById('phone-message');
            phoneMessage.style.display = 'none';
        }
        
        // Load the restaurant details based on the URL parameter
        document.addEventListener('DOMContentLoaded', function() {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const restaurantId = urlParams.get('id');
        
            if (restaurantId && restaurantData[restaurantId]) {
                updateRestaurantDetails(restaurantData[restaurantId]);
            } else {
                document.getElementById('restaurant-name').textContent = 'Restaurant Not Found';
            }
        
            // Attach event listener to the close button of the phone message
            const closePhoneMessageBtn = document.getElementById('close-phone-message');
            if (closePhoneMessageBtn) {
                closePhoneMessageBtn.addEventListener('click', closePhoneMessage);
            }
        });
        
        
        
        
        
        
        
        
        
        
        //modes for sign in
        document.addEventListener('DOMContentLoaded', function() {
            var mode = localStorage.getItem('mode'); // 0 for signed out, 1 for signed in
            var username = localStorage.getItem('username');
        
            if (mode === '1' && username&&username==='admin@123') {
                var signinLink = document.getElementById('signinLink');
                signinLink.textContent = username + ' \uD83D\uDC68'; // Display the username with an emoji
                signinLink.href = 'admin.html';
            }
            else if(mode === '1' && username){
                var signinLink = document.getElementById('signinLink');
                signinLink.textContent = username + ' \uD83D\uDC68'; // Display the username with an emoji
                signinLink.href = 'profile.html';
            }
        
            document.querySelector('form').addEventListener('submit', function(event) {
                event.preventDefault();
        
                var email = document.getElementById('email').value.toLowerCase();
                var password = document.getElementById('password').value;
        
                // Admin check
                if (email === 'admin@123' && password === '123') {
                    localStorage.setItem('mode', '1');
                    localStorage.setItem('username', 'admin@123'); // Admin as a special username
                    window.location.href = 'admin.html';
                    
                } else {
                    var allUsers = JSON.parse(localStorage.getItem('users')) || [];
                    var acceptedRestaurants = JSON.parse(localStorage.getItem('acceptedRestaurants')) || [];
                    var requestFormData = JSON.parse(localStorage.getItem('requestFormData')) || [];
        
                    // Combine all user data sources into one array
                    var combinedUsers = allUsers.concat(acceptedRestaurants, requestFormData);
        
                    var userExists = combinedUsers.some(function(user) {
                        return user.email === email && user.password === password;
                    });
        
                    if (userExists) {
                        localStorage.setItem('mode', '1');
                        localStorage.setItem('username', email);
                        history.back(); // Go back to the previous page or redirect as needed
                    } else {
                        alert('Invalid email or password. Please try again.');
                    }
                }
            });
        });
        
        
        
        
        
        
        
        
        
        
        document.getElementById('reservation-button').addEventListener('click', function() {
            var mode = localStorage.getItem('mode'); // Get mode from local storage
            var loginPrompt = document.getElementById('login-prompt');
            var reservationForm = document.getElementById('reservation-form');
            var modalCover = document.createElement('div');
            modalCover.className = 'modal-cover';
        
            document.body.appendChild(modalCover); // Add cover to the body
        
            if(mode === '1') {
                // User is signed in
                reservationForm.style.display = 'block';
                modalCover.style.display = 'block';
            } else {
                // User is not signed in
                loginPrompt.style.display = 'block';
                modalCover.style.display = 'block';
            }
        
            // Close modals on background click
            modalCover.addEventListener('click', function() {
                reservationForm.style.display = 'none';
                loginPrompt.style.display = 'none';
                modalCover.style.display = 'none';
                document.body.removeChild(modalCover);
            });
        });
        
        
        
        
        
        // detailsjava.js
        document.addEventListener('DOMContentLoaded', function() {
            // Function to get the query parameter by name
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }
        
            // Retrieve the id from the URL
            const restaurantId = getQueryParam('id');
        
            // Retrieve the list of accepted restaurants
            const acceptedRestaurants = JSON.parse(localStorage.getItem('acceptedRestaurants')) || [];
            // Find the restaurant data by id
            const restaurant = acceptedRestaurants.find(r => r.id === restaurantId);
        
            if (restaurant) {
                // Set the content on the page
                document.getElementById('restaurant-name').textContent = restaurant.name;
                document.getElementById('restaurant-description').textContent = restaurant.description;
                document.getElementById('restaurant-image').src = restaurant.photoUrl;
                document.getElementById('restaurant-image').alt = `Image of ${restaurant.name}`;
                
                // Set links and other info
                document.getElementById('location-icon').href = `http://maps.google.com/?q=${restaurant.location}`;
                document.getElementById('phone-number').textContent = restaurant.phone;
                document.getElementById('menu-icon').href = restaurant.menuUrl;
        
                const reservationSubmitButton = document.getElementById('reservation-submit');
                reservationSubmitButton.value = restaurant.email;
        
            } else {
                console.error('Restaurant data not found.');
            }
        
            // Show phone number in modal
            document.getElementById('phone-icon').addEventListener('click', () => {
                document.getElementById('phone-message').style.display = 'block';
            });
        
            // Close phone message
            document.getElementById('close-phone-message').addEventListener('click', () => {
                document.getElementById('phone-message').style.display = 'none';
            });
        });
        
        
        
        
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('reservation-form');
        
            form.addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent form submission
                
                // Retrieve username from localStorage
                const username = localStorage.getItem('username');
                if (!username) {
                    alert('Please log in to make a reservation.');
                    return;
                }
        
                // Collect form data
                const formData = {
                    status:'pending',
                    username: username,
                    rusername:document.getElementById('reservation-submit').value,
                    number: document.getElementById('number').value,
                    date: document.getElementById('date').value,
                    time: document.getElementById('time').value
                };
        
                // Save registration data in localStorage
                let reservations = JSON.parse(localStorage.getItem('reservations')) || [];
                reservations.push(formData);
                localStorage.setItem('reservations', JSON.stringify(reservations));
        
                
                window.back();
            });
        });
        </script>
</body>
</html>
